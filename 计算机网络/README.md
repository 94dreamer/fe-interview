### 网络模型7层/5层/4层有哪些
OSI七层：
- 应用层
- 表示层
- 会话层
- 运输层
- 网络层
- 数据链路层
- 物理层

五层协议：
- 应用层
- 传输层
- 网络层
- 数据链路层
- 物理层

TCP/IP：
- 应用层
- 传输层
- 网际层
- 网络接口层

### TCP和UDP协议的区别
TCP提供可靠性传输，面向连接
流量控制、拥塞控制、全双工通信，面向字节流。
把一个报文可能拆成多份，保证顺序、可靠，因此会重试。

UDP提供实时性传输，面向交付
无脑只管发，不建立链接，没有一对一限制，没有拥塞控制，也不对应用层的报文做拆分和合并。
明显没有TCP那么重。

### TCP的三次握手过程
先发起请求，服务端响应
在发起请求，我知道了。
第三次我要开始发送数据了

### TCP的可靠性交付是基于什么的？
- 滑动窗口
- 超时重传
- 流量控制
- 拥塞控制

### DNS是什么东西
- 域名解析系统，维护把域名翻译成IP映射表的服务器。
- 浏览器、操作系统、每个网络运营商都会部署，如果找不到就会往根上找。

### CDN是什么？优势是什么，回源是什么，劣势
内容分发网络。
优势：部署了很多节点，资源在有被访问时候通过节点代理请求，就缓存到了就近的节点上了，用户可以就近访问缓存。快、带宽压力小。
策略：域名通过运营商的DNS解析转到了一个职能的DNS服务器，返回了一个就近的节点。
回源：就近的节点没有缓存，就回到上一层的服务器去找，直到源服务器。
更新机制：有两种，一种是源服务器推送更新，一种是分布式节点定期去原服务器查询更新情况。
劣势：

### HTTP缓存控制如何做的？ 
强缓存：200
两个header控制： Expires / Cache-Control
Cache-Control优先级更高后出，就是为了补全 Expires 是客户端时间不准确也不够全面的问题。

协商缓存：403
两个header控制： if-modified-since/last-modified E-tag/if-none-match 
E-tag优先级更高，因为 last-modify-time 虽然是服务端时间，但是是秒级别的，E-tag是文本摘要更准确些。
E-tag在分布式系统上也会有问题，因为tag根据内容和创建时间的hash决定的。

协商缓存的头先由服务器返回，下一次请求带上。

默认缓存的过期时间是多久：启发式算法，目前新鲜度的10%

### HTTPS的加密过程是怎么样的？
HTTPS的加密是采用的非对称加密+对称加密的方式，先用非对称加密交换对称密钥，接下来都用对称密钥传递信息。  
本质是 系统信任根证书=>CA证书链非对称加密=>网站非对称加密=>客户端对称加密 这几个的环环相扣。
> 因为非对称加密消耗太大，但是对称加密第一次泄密风险大。

对称加密：用同一种钥匙去加密和解密。
非对称加密：一枚公钥，一枚私钥。公钥用来解开私钥加密东西，公钥加密的东西私钥才可以解开。
CA证书：上述的问题就是非对称加密传递的公钥可能被中间人拦截替换，所以需要一个东西来证明公钥的可靠性。


过程：
1. 客户端将自己认可的一套加密规则和一个随机数client-random发送给服务器。
2. 服务端选出一组加密算法与HASH算法，将自己的身份信息以CA机构颁发的证书的形式回传，证书包含数字签名（地址、公钥、证书颁发机构）摘要。摘要的部分用CA机构的私钥加密了。其次也包括随机数server-random。
3. 客户端校验证书合法性，分别是
    1. 用上一级CA机构的公钥去解密摘要部分，然后把数字签名本身进行hash解密，对比是否一致，如果不一致，说明被篡改了。
    2. 如果校验没有被篡改，在去校验数字签名信息的网站信息是否一致，证书时间是否过期。
4. 客户端用证书的公钥加密随机生成的pre-master发送给服务端，生成master-secret
5. 服务端用私钥解密，拿到随机生成的pre-master生成master-secret，接下来都用这个密钥进行对称加密通信。

### HTTPS的证书的申请和验证是怎么样的
申请过程：去一个证书认证机构申请，提供网站信息和公钥，然后对证书进行摘要，一并放进证书，对摘要CA的私钥加密。
证书内容：公钥、网站、证书颁发机构、摘要。
验证过程：客户端拿到证书，判断摘要是否和客户端对证书的摘要是一致的，其次验证有效期、是否吊销、网站是否对应。

> 如果数字签名本身和摘要都修改了怎么办呢？没关系。  
首先，我们会用CA的公钥去解密，这就需要篡改者拿到CA的私钥。这个是拿不到的。

> 浏览器如如何获取CA公钥的？
- 服务器把自己的证书和给自己签名的CA机构的证书一并发送给浏览器
- 浏览器通过网络去下载CA证书，这个会拖慢首次打开页面的请求速度

> 证明CA机构的合法性
- 首先证明自己是被上级的CA公钥能够验证合法性
- 然后循着证书链依次验证合法性，直到能够在系统根证书里面找到。

证书申请：[https://freessl.cn/](https://freessl.cn/)

### HTTP2相较于HTTP1的区别
HTTP1的劣势：同个域名多个TCP连接之间抢占资源，导致阻塞。

- 多路复用，一个域名只建立一个TCP链接。
- 头部压缩
- 服务器推送
- 设置请求优先级

劣势：因为只建立一个TCP连接，所以丢包情况下，阻塞情况更甚。

### HTTP3的特征有哪些，是怎么做的？
传输层协议的改动需要中间机器也通用支持，涉及到链路改造，在目前这样繁琐的网络环境下如无法做到渐进式支持的。
所以基于UDP在应用层使用QUIC协议完成可靠性保证，不使用TCP。

### RPC是什么，有哪些方式，相较于HTTP传输的好处？
RPC一般是基于TCP来实现的应用层协议，用来实现微服务集群下的服务器方法调用。

RPC想要做到调用远程机器的方法就像调用本地方法一样，并且是更高性能的，数据传输尽可能的精简，不需要缓存，使用者不需要考虑安全，内部保证信任。
对使用者来说，RPC
- 因此需要协议封装，面向函数，出入参都是对象
- RPC框架处理了连接失败、重试、发送失败、超时、重试失败等场景
- RPC通过服务发现和注册来实现找到对应机器。

对内部来说，RPC
- 对象无法传输必须要进行序列化，传输用的二进制
- 没有缓存等功能
